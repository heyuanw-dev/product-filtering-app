<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Products</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    form { display: grid; gap: .75rem; margin-bottom: 1rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: .75rem; }
    .filters { display: flex; gap: 1rem; flex-wrap: wrap; }
    .tag-list { max-height: 8rem; overflow: auto; border: 1px solid #ddd; padding: .5rem; }
    .pagination a, .pagination span { margin-right: .5rem; }
  </style>
</head>
<body>
  <h1>Products</h1>

  <form method="get">
    <div class="filters">
      <label>
        Search description:
        <input type="text" name="q" value="{{ q }}" placeholder="e.g. leather, 4K, organic">
      </label>

      <label>
        Category:
        <select name="category">
          <option value="">-- Any --</option>
          {% for c in categories %}
            <option value="{{ c.slug }}" {% if c.slug == selected_category %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </label>

      <label>
        Tags (any):
        <div class="tag-list">
          {% for t in tags %}
            <label style="display:block;">
              <input type="checkbox" name="tags" value="{{ t.slug }}"
                {% if t.slug in selected_tags %}checked{% endif %}>
              {{ t.name }}
            </label>
          {% endfor %}
        </div>
      </label>

      <div style="align-self: end;">
        <button type="submit">Apply</button>
        <a href="{% url 'product_list' %}">Reset</a>
      </div>
    </div>
  </form>

  {% if page_obj.object_list %}
    <div class="grid">
      {% for p in page_obj.object_list %}
        <div class="card">
          <h3 style="margin:.25rem 0 0 0;">{{ p.name }}</h3>
          <small>Category: {{ p.category.name }}</small>
          <p>{{ p.description|default:"(no description)" }}</p>
          {% if p.tags.all %}
            <p><small>Tags:
              {% for t in p.tags.all %}{{ t.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
            </small></p>
          {% endif %}
          <p><strong>${{ p.price }}</strong></p>
        </div>
      {% endfor %}
    </div>

    <div class="pagination" style="margin-top:1rem;">
      {% if page_obj.has_previous %}
        <a href="?{{ query_string }}&page={{ page_obj.previous_page_number }}">Previous</a>
      {% endif %}
      <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?{{ query_string }}&page={{ page_obj.next_page_number }}">Next</a>
      {% endif %}
    </div>
  {% else %}
    <p>No products found. Try adjusting filters.</p>
  {% endif %}
</body>
</html>
